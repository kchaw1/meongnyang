<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nmcat.repository.mapper.CommunityMapper">
<resultMap id="comMap" type="CommunityBoard">
		<result column="com_no" property="comNo" />
		<result column="com_title" property="comTitle" />
		<result column="com_writer" property="comWriter" />
		<result column="com_content" property="comContent" />
		<result column="com_category" property="comCategory" />
		<result column="com_rec_cnt" property="comRecCnt" />
		<result column="com_view_cnt" property="comViewCnt" />
		<result column="com_reg_date" property="comRegDate" />
	</resultMap>
	
	
<resultMap id = "comfMap" type = "CommunityFile">
	
	<result column = "com_no" property= "comNo"/>
	<result column = "comf_sys_name" property= "comfSysName"/>
	<result column = "comf_path" property= "comfPath"/>
	
</resultMap>

<resultMap id = "comcMap" type = "CommunityComment">
	<result column = "comc_no" property= "comcNo"/>
	<result column = "com_no" property= "comNo"/>
	<result column = "comc_writer" property= "comcWriter"/>
	<result column = "comc_content" property= "comcContent"/>
	<result column = "comc_reg_date" property="comcRegDate" />
	
</resultMap>
	<!-- 커뮤니티 CRUD -->
	

	<!-- 커뮤니티 무한스크롤 전체게시물 가져오기 +페이징+ 카테고리별-->
	<select id = "selectBoard" parameterType = "CommunityBoard" resultMap = "comMap">
	select *
	from mn_com
	<choose>
		<when test = "searchType == 1">
		 order by com_no desc
		</when>
		<when test = "searchType == 2">
		where com_category ='자유게시판'
		 order by com_no desc
		</when>
		<when test = "searchType == 3">
		where com_category ='꿀팁'
		 order by com_no desc
		</when>
		<when test = "searchType == 4">
		where com_category ='갤러리'
		 order by com_no desc
		</when>
		<otherwise>
		where com_category ='QnA'
		 order by com_no desc
		</otherwise>
	</choose>
 	limit #{begin}, 10
	</select>
	
	<!-- 상세보기 -->
	<select id = "detailBoard" parameterType = "int" resultMap = "comMap">
	select *
	from mn_com
	where com_no = #{comNo}
	</select>
	
	<!-- 커뮤니티 글 등록 -->
	<insert id = "insertBoard" parameterType ="CommunityBoard">
	insert into mn_com
 	(com_title, com_writer, com_content, com_category)
	 values(#{comTitle},#{comWriter}, #{comContent}, #{comCategory});
	</insert>
	
	<!-- 커뮤니티 글 삭제 -->
	<delete id = "deleteBoard" parameterType = "int">
	delete
	from mn_com
	where com_no = #{comNo}
	</delete>
	
	<!-- 커뮤니티 글 수정 -->
	<update id = "updateBoard" parameterType = "CommunityBoard">
	update mn_com
	set com_title = #{comTitle},
	 	com_writer = #{comWriter},
	 	com_content = #{comContent},
	 	com_category = #{comCategory}
	where com_no = #{comNo}
	</update>
	
	<!-- 커뮤니티 전체 게시물의 수 -->
	<select id = "selectBoardCount" resultType = "int" >
	select count(*)
	from
	mn_com
	</select>
	
	<!-- **************************************************** -->
	<!-- 댓글 CRUD -->
	
	
	<!-- 댓글 조회 -->
	<select id = "selectComment" parameterType = "int" resultMap = "comcMap">
	select *
	from mn_com_comment
	where com_no = #{comNo}
	</select>
	
	<!-- 댓글 등록 -->
	<insert id = "insertComment" parameterType = "CommunityComment">
	insert into mn_com_comment
	(com_no, comc_writer, comc_content)
	 values
	 (#{comNo}, #{comcWriter}, #{comcContent})
	</insert>
	
	<!-- 댓글 삭제 -->
	<delete id = "deleteComment" parameterType = "int">
	delete
	from mn_com_comment
	where comc_no = #{comcNo}
	</delete>
	
	<!-- 댓글 수정 -->
	<update id = "updateComment" parameterType = "CommunityComment">
	update mn_com_comment
	set comc_content = #{comcContent}
	where comc_no = #{comcNo}
	</update>
	<!-- 각 게시물당 댓글 갯수 -->
	<!-- 커뮤니티 전체 게시물의 수 -->
	<select id = "selectCommentCount" parameterType = "int" resultType = "int" >
	select count(*)
	from
	mn_com_comment
	where com_no = #{comNo}
	</select>
	<!-- 파일 등록 -->
	<insert id = "insertBoardFile" parameterType = "CommunityComment">
	insert into mn_com_file(
		com_no, comf_sys_name, comf_path
	) values (
		#{comNo}, #{comfSysName}, #{comfPath}
	)
	</insert>
	
	
</mapper>